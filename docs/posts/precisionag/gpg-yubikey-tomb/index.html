<!DOCTYPE html>
<html lang="en" style="
     --accent-color:#8e2a8b ;
    
        
            --bg-color:#c4d0d1; --fg-color:#080a0f;
        
     ">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
    Backing up GPG key with YubiKey, Tomb and Cryptosetup Â· ecopom
</title>
        <meta name="author" content="ECOPOM">
        <meta name="description" content="LAB - Website">
        <meta name="keywords" content="blog,news,oppurtitnities,lab">
         <base href="/posts/precisionag/gpg-yubikey-tomb/"> 
         <link rel="canonical" href="/posts/precisionag/gpg-yubikey-tomb/"> 

        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

        
        
        <link rel="stylesheet" href="/coder/coder.min.css" integrity="" crossorigin="anonymous" media="screen" />
        
        

        <link rel="icon" type="image/png" href="/images/favicon.svg">
        <meta name="generator" content="Hugo 0.63.1" />
        
        
    </head>
    <body>
            

        
            
                
                
                
            
        

        
        
        <main id="main" class="wrapper gpg-yubikey-tomb">
            <nav class="navigation">
  <section class="container">
      <label class="title">
          <a class="navigation-title" href="/">
              ecopom
          </a>
      </label>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="/about/">about</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/team">team</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/posts/">posts</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="/news/">news</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>

            <div class="content">
                
    
    
        <section class="container page estate" >
    <article>
        <header>
            
                <h1 class="gpg-yubikey-tomb title glitchtitle"  data-text="Backing up GPG key with YubiKey, Tomb and Cryptosetup" >Backing up GPG key with YubiKey, Tomb and Cryptosetup</h1>
            
            
                
                    
                
            
            
            <div class="undertitle" style="padding-left:2%;" >
                <details class="dropdown" >
                    <summary>
                        <span id="title_part" style="color:var(--bg-color); background-color:var(--accent-color); cursor: pointer; display:inline-block;" >&nbsp;INDEX&nbsp;</span>
                        <span style="color:var(--fg-color)">|</span>

                        
                        <span id="title_categories" style="color:var(--accent-color) display:inline-block;" >
                            Category: 
                            
                                
                                
                                    <a href="/categories/linux/" >LINUX</a>
                                
                            
                            <span style="color:var(--fg-color)">|</span>
                        </span>
                        
                        <span id="title_tags" style="color:var(--accent-color) display:inline-block;" >
                             Tags: 
                            
                                
                                
                                <a href="/tags/yubikey/" >yubikey</a>
                                
                            
                                
                                
                                <a href="/tags/gpg/" >gpg</a>
                                
                            
                                
                                
                                <a href="/tags/pass/" >pass</a>
                                
                            
                                
                                
                                <a href="/tags/tomb/" >tomb</a>
                                
                            
                                
                                
                                <a href="/tags/cryptosetup/" >cryptosetup</a>
                                
                            
                            <span style="color:var(--fg-color)">|</span>
                        </span>

                        

                        
                        <span id="title_series" style="color:var(--accent-color) display:inline-block;" >
                            Series: 
                            
                                
                                
                                <a href="/series/gpg/" >GPG</a>
                                
                            
                            
                                <span id="title_part" style="color:var(--bg-color); background-color:var(--accent-color); cursor: pointer;" >&nbsp;PART 1&nbsp;</span>
                            
                            <span style="color:var(--fg-color)">|</span>
                        </span>
                    </summary>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#secure-environment">SECURE ENVIRONMENT</a></li>
    <li><a href="#gpg-keys">GPG-KEYS</a>
      <ul>
        <li><a href="#masterkey">MASTERKEY</a></li>
        <li><a href="#subkeys">SUBKEYS</a>
          <ul>
            <li><a href="#signing-sub-key">SIGNING SUB-KEY</a></li>
            <li><a href="#encryption-sub-key">ENCRYPTION SUB-KEY</a></li>
            <li><a href="#authentication-sub-key">AUTHENTICATION SUB-KEY</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#digging-tombs-and-forging-keys">DIGGING TOMBS AND FORGING KEYS</a>
      <ul>
        <li><a href="#forging-keys">FORGING KEYS</a></li>
        <li><a href="#dig-a-tomb">DIG A TOMB</a></li>
        <li><a href="#lock-the-tomb">LOCK THE TOMB</a></li>
        <li><a href="#open-the-tomb">OPEN THE TOMB</a></li>
        <li><a href="#slam-everything">SLAM EVERYTHING</a></li>
      </ul>
    </li>
    <li><a href="#backing-up-keys">BACKING-UP KEYS</a>
      <ul>
        <li><a href="#pubickey-backup">PUBICKEY BACKUP</a></li>
        <li><a href="#subkey-backup">SUBKEY BACKUP</a></li>
        <li><a href="#masterkey-backup">MASTERKEY BACKUP</a></li>
        <li><a href="#invocation-certificate">INVOCATION CERTIFICATE</a></li>
      </ul>
    </li>
    <li><a href="#cryptoluks">CRYPTOLUKS</a></li>
  </ul>
</nav>
                </details>
            </div>
            
        </header>
        <span class=" blogpost " style=" --titlecolor: var(--accent-color);" >
            <p>In this short post, i will show how to generate secure GPG keys using secure liunx enviroiment and other secure linux tools.</p>
<p>Steps that we'&lsquo;ll go through are:</p>
<ul>
<li>Generate a live secure enviroiment (TAILS)</li>
<li>Generate GPG-Keys</li>
<li>Diging secure tombs and forging keys</li>
<li>Backing-up keys and revocation certificates</li>
<li>Backing up keys in crypto LUKS drive</li>
</ul>
<h1 id="secure-environment">SECURE ENVIRONMENT</h1>
<p>Lets make a working folder where we create file, keys, tombs ad so on. Lets call it <code>/home/$USER/TEMP</code> and export as variable <code>export GPGPATH=/home/$USER/TEMP</code></p>
<h1 id="gpg-keys">GPG-KEYS</h1>
<h2 id="masterkey">MASTERKEY</h2>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; gpg --expert --full-generate-key </div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">Please <span class="k">select</span> what kind of key you want:
   <span class="o">(</span>1<span class="o">)</span> RSA and RSA <span class="o">(</span>default<span class="o">)</span>
   <span class="o">(</span>2<span class="o">)</span> DSA and Elgamal
   <span class="o">(</span>3<span class="o">)</span> DSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>4<span class="o">)</span> RSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>7<span class="o">)</span> DSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
   <span class="o">(</span>8<span class="o">)</span> RSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
   <span class="o">(</span>9<span class="o">)</span> ECC and ECC
  <span class="o">(</span>10<span class="o">)</span> ECC <span class="o">(</span>sign only<span class="o">)</span>
  <span class="o">(</span>11<span class="o">)</span> ECC <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>13<span class="o">)</span> Existing key
  <span class="o">(</span>14<span class="o">)</span> Existing key from card
Your selection? <span class="m">8</span>
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Certify Encrypt Authenticate 
Current allowed actions: Sign Certify Encrypt 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? E
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Certify Encrypt Authenticate 
Current allowed actions: Sign Certify 

   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? S
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Certify Encrypt Authenticate 
Current allowed actions: Certify 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? Q
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">RSA keys may be between <span class="m">1024</span> and <span class="m">4096</span> bits long.
What keysize <span class="k">do</span> you want? <span class="o">(</span>2048<span class="o">)</span> <span class="m">4096</span>
Requested keysize is <span class="m">4096</span> bits
Please specify how long the key should be valid.
         <span class="nv">0</span> <span class="o">=</span> key does not expire
      &lt;n&gt;  <span class="o">=</span> key expires in n days
      &lt;n&gt;w <span class="o">=</span> key expires in n weeks
      &lt;n&gt;m <span class="o">=</span> key expires in n months
      &lt;n&gt;y <span class="o">=</span> key expires in n years
Key is valid <span class="k">for</span>? <span class="o">(</span>0<span class="o">)</span> <span class="m">0</span>
Key does not expire at all
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">GnuPG needs to construct a user ID to identify your key.
Real name: Bruce Wayne
Email address: bruce.wayne@waynecorp.com
Comment: JLA Launch Code PGP
You selected this USER-ID:
    <span class="s2">&#34;Bruce Wayne (JLA Launch Code PGP) &lt;bruce.wayne@waynecorp.com&gt;&#34;</span>
Change <span class="o">(</span>N<span class="o">)</span>ame, <span class="o">(</span>C<span class="o">)</span>omment, <span class="o">(</span>E<span class="o">)</span>mail or <span class="o">(</span>O<span class="o">)</span>kay/<span class="o">(</span>Q<span class="o">)</span>uit? O
</code></pre></div><p>Depending on what OS/Distro you are using, a keyring window will open asking you to give the pasphrase for this newly generated key, and after that the key will be generated and will be something similar to this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">pub   rsa4096 2020-01-10 <span class="o">[</span>C<span class="o">]</span>
      6E1214FB62C67F9576BD2E008E1C7857051C93A2
uid                      Bruce Wayne <span class="o">(</span>JLA Launch Code PGP<span class="o">)</span> &lt;bruce.wayne@waynecorp.com&gt;
</code></pre></div><h2 id="subkeys">SUBKEYS</h2>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; gpg --expert --edit-key bruce.wayne@waynecorp.com </div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">What keysize do you want? (2048) 4096
Requested keysize is 4096 bits
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0) 1y
Key expires at Sat 09 Jan 2021 12:27:57 PM CET
Secret key is available.
gpg: checking the trustdb
gpg: public key of ultimately trusted key FE80CE51B8A1EE02 not found
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:   3  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 3u
sec  rsa4096/8E1C7857051C93A2
     created: 2020-01-10  expires: never       usage: C   
     trust: ultimate      validity: ultimate
[ultimate] (1). Bruce Wayne (JLA Launch Code PGP) &lt;bruce.wayne@waynecorp.com&gt;
</code></pre></div><h3 id="signing-sub-key">SIGNING SUB-KEY</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg&gt; addkey
Please <span class="k">select</span> what kind of key you want:
   <span class="o">(</span>3<span class="o">)</span> DSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>4<span class="o">)</span> RSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>5<span class="o">)</span> Elgamal <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>6<span class="o">)</span> RSA <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>7<span class="o">)</span> DSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
   <span class="o">(</span>8<span class="o">)</span> RSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>10<span class="o">)</span> ECC <span class="o">(</span>sign only<span class="o">)</span>
  <span class="o">(</span>11<span class="o">)</span> ECC <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>12<span class="o">)</span> ECC <span class="o">(</span>encrypt only<span class="o">)</span>
  <span class="o">(</span>13<span class="o">)</span> Existing key
  <span class="o">(</span>14<span class="o">)</span> Existing key from card
Your selection? <span class="m">4</span>
--------------------------------
RSA keys may be between <span class="m">1024</span> and <span class="m">4096</span> bits long.
What keysize <span class="k">do</span> you want? <span class="o">(</span>2048<span class="o">)</span> <span class="m">4096</span>
Requested keysize is <span class="m">4096</span> bits
--------------------------------
Please specify how long the key should be valid.
         <span class="nv">0</span> <span class="o">=</span> key does not expire
      &lt;n&gt;  <span class="o">=</span> key expires in n days
      &lt;n&gt;w <span class="o">=</span> key expires in n weeks
      &lt;n&gt;m <span class="o">=</span> key expires in n months
      &lt;n&gt;y <span class="o">=</span> key expires in n years
Key is valid <span class="k">for</span>? <span class="o">(</span>0<span class="o">)</span> 1y
Key expires at Sat <span class="m">09</span> Jan <span class="m">2021</span> 11:04:05 AM CET
</code></pre></div><p>After the sign subkey is added we get this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sec  rsa4096/8E1C7857051C93A2
     created: 2020-01-10  expires: never       usage: C   
     trust: ultimate      validity: ultimate
ssb  rsa4096/9E6A1C2867590559
     created: 2020-01-10  expires: 2021-01-09  usage: S   
<span class="o">[</span>ultimate<span class="o">]</span> <span class="o">(</span>1<span class="o">)</span>. Bruce Wayne <span class="o">(</span>JLA Launch Code PGP<span class="o">)</span> &lt;bruce.wayne@waynecorp.com&gt;
</code></pre></div><h3 id="encryption-sub-key">ENCRYPTION SUB-KEY</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg&gt; addkey                                                                                                                                    
Please <span class="k">select</span> what kind of key you want:
   <span class="o">(</span>3<span class="o">)</span> DSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>4<span class="o">)</span> RSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>5<span class="o">)</span> Elgamal <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>6<span class="o">)</span> RSA <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>7<span class="o">)</span> DSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
   <span class="o">(</span>8<span class="o">)</span> RSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>10<span class="o">)</span> ECC <span class="o">(</span>sign only<span class="o">)</span>
  <span class="o">(</span>11<span class="o">)</span> ECC <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>12<span class="o">)</span> ECC <span class="o">(</span>encrypt only<span class="o">)</span>
  <span class="o">(</span>13<span class="o">)</span> Existing key
  <span class="o">(</span>14<span class="o">)</span> Existing key from card
Your selection? <span class="m">6</span>
--------------------------------
RSA keys may be between <span class="m">1024</span> and <span class="m">4096</span> bits long.
What keysize <span class="k">do</span> you want? <span class="o">(</span>2048<span class="o">)</span> <span class="m">4096</span>
Requested keysize is <span class="m">4096</span> bits
--------------------------------
Please specify how long the key should be valid.
         <span class="nv">0</span> <span class="o">=</span> key does not expire
      &lt;n&gt;  <span class="o">=</span> key expires in n days
      &lt;n&gt;w <span class="o">=</span> key expires in n weeks 
      &lt;n&gt;m <span class="o">=</span> key expires in n months
      &lt;n&gt;y <span class="o">=</span> key expires in n years 
Key is valid <span class="k">for</span>? <span class="o">(</span>0<span class="o">)</span> 1y
Key expires at Sat <span class="m">09</span> Jan <span class="m">2021</span> 12:20:57 PM CET
</code></pre></div><p>After the encrypt subkey is added we get this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sec  rsa4096/8E1C7857051C93A2
     created: 2020-01-10  expires: never       usage: C   
     trust: ultimate      validity: ultimate
ssb  rsa4096/9E6A1C2867590559
     created: 2020-01-10  expires: 2021-01-09  usage: S   
ssb  rsa4096/1FAA09C20C96A6E6
     created: 2020-01-10  expires: 2021-01-09  usage: E   
<span class="o">[</span>ultimate<span class="o">]</span> <span class="o">(</span>1<span class="o">)</span>. Bruce Wayne <span class="o">(</span>JLA Launch Code PGP<span class="o">)</span> &lt;bruce.wayne@waynecorp.com&gt;
</code></pre></div><h3 id="authentication-sub-key">AUTHENTICATION SUB-KEY</h3>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">gpg&gt; addkey
Please <span class="k">select</span> what kind of key you want:
   <span class="o">(</span>3<span class="o">)</span> DSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>4<span class="o">)</span> RSA <span class="o">(</span>sign only<span class="o">)</span>
   <span class="o">(</span>5<span class="o">)</span> Elgamal <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>6<span class="o">)</span> RSA <span class="o">(</span>encrypt only<span class="o">)</span>
   <span class="o">(</span>7<span class="o">)</span> DSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
   <span class="o">(</span>8<span class="o">)</span> RSA <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>10<span class="o">)</span> ECC <span class="o">(</span>sign only<span class="o">)</span>
  <span class="o">(</span>11<span class="o">)</span> ECC <span class="o">(</span><span class="nb">set</span> your own capabilities<span class="o">)</span>
  <span class="o">(</span>12<span class="o">)</span> ECC <span class="o">(</span>encrypt only<span class="o">)</span>
  <span class="o">(</span>13<span class="o">)</span> Existing key
  <span class="o">(</span>14<span class="o">)</span> Existing key from card
Your selection? <span class="m">8</span>
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Encrypt Authenticate 
Current allowed actions: Sign Encrypt 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? S
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Encrypt Authenticate 
Current allowed actions: Encrypt 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? E
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Encrypt Authenticate 
Current allowed actions: 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? A
--------------------------------
Possible actions <span class="k">for</span> a RSA key: Sign Encrypt Authenticate 
Current allowed actions: Authenticate 
   <span class="o">(</span>S<span class="o">)</span> Toggle the sign capability
   <span class="o">(</span>E<span class="o">)</span> Toggle the encrypt capability
   <span class="o">(</span>A<span class="o">)</span> Toggle the authenticate capability
   <span class="o">(</span>Q<span class="o">)</span> Finished
Your selection? Q
--------------------------------
RSA keys may be between <span class="m">1024</span> and <span class="m">4096</span> bits long.
What keysize <span class="k">do</span> you want? <span class="o">(</span>2048<span class="o">)</span> <span class="m">4096</span>
Requested keysize is <span class="m">4096</span> bits
--------------------------------
Please specify how long the key should be valid.
         <span class="nv">0</span> <span class="o">=</span> key does not expire
      &lt;n&gt;  <span class="o">=</span> key expires in n days
      &lt;n&gt;w <span class="o">=</span> key expires in n weeks
      &lt;n&gt;m <span class="o">=</span> key expires in n months
      &lt;n&gt;y <span class="o">=</span> key expires in n years
Key is valid <span class="k">for</span>? <span class="o">(</span>0<span class="o">)</span> 1y
Key expires at Sat <span class="m">09</span> Jan <span class="m">2021</span> 12:27:57 PM CET
</code></pre></div><p>After the authentication subkey is added we get this:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sec  rsa4096/8E1C7857051C93A2
     created: 2020-01-10  expires: never       usage: C   
     trust: ultimate      validity: ultimate
ssb  rsa4096/9E6A1C2867590559
     created: 2020-01-10  expires: 2021-01-09  usage: S   
ssb  rsa4096/1FAA09C20C96A6E6
     created: 2020-01-10  expires: 2021-01-09  usage: E   
ssb  rsa4096/CC964AFC82754FD0
     created: 2020-01-10  expires: 2021-01-09  usage: A   
<span class="o">[</span>ultimate<span class="o">]</span> <span class="o">(</span>1<span class="o">)</span>. Bruce Wayne <span class="o">(</span>JLA Launch Code PGP<span class="o">)</span> &lt;bruce.wayne@waynecorp.com&gt;

</code></pre></div><h1 id="digging-tombs-and-forging-keys">DIGGING TOMBS AND FORGING KEYS</h1>
<p>Tomb is a free and open source system for file encryption on GNU/Linux. I is written in shell code that is easy to look and review. It works by generating encrypted storage folders to be opened and closed using their associated keyfiles, which are also generated with tomb and protected with a password chosen by the user. A tomb is like a locked folder that can be safely transported and hidden in a filesystem; its keys can be kept separate, for instance keeping the tomb file on your computer harddisk and the key files on a USB stick.</p>
<p>You can get tomb through any of your prefered package manader for your distro (apt,yum,yay) which, obviously, I am not gonna show it here. Once you have it installed you can test is by calling it:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb </div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  Syntax: tomb <span class="o">[</span>options<span class="o">]</span> <span class="nb">command</span> <span class="o">[</span>arguments<span class="o">]</span>
  Commands:
   dig          create a new empty TOMB file of size -s in MiB
   forge        create a new KEY file and <span class="nb">set</span> its password
   lock         installs a lock on a TOMB to use it with KEY
   open         open an existing TOMB <span class="o">(</span>-k KEY file or - <span class="k">for</span> stdin<span class="o">)</span>
   index        update the search indexes of tombs
   search       looks <span class="k">for</span> filenames matching text patterns
   list         list of open TOMBs and information on them
   ps           list of running processes inside open TOMBs
   close        close a specific TOMB <span class="o">(</span>or <span class="s1">&#39;all&#39;</span><span class="o">)</span>
   slam         slam a TOMB killing all programs using it
   resize       resize a TOMB to a new size -s <span class="o">(</span>can only grow<span class="o">)</span>
   passwd       change the password of a KEY <span class="o">(</span>needs old pass<span class="o">)</span>
   setkey       change the KEY locking a TOMB <span class="o">(</span>needs old key and pass<span class="o">)</span>
   bury         hide a KEY inside a JPEG image <span class="o">(</span><span class="k">for</span> use with -k<span class="o">)</span>
   exhume       extract a KEY from a JPEG image <span class="o">(</span>prints to stdout<span class="o">)</span>

  Options:
   -s           size of the tomb file when creating/resizing one <span class="o">(</span>in MiB<span class="o">)</span>
   -k           path to the key to be used <span class="o">(</span><span class="s1">&#39;-k -&#39;</span> to <span class="nb">read</span> from stdin<span class="o">)</span>
   -n           don<span class="err">&#39;</span>t launch the execution hooks found in tomb
   -p           preserve the ownership of all files in tomb
   -o           options passed to commands: open, lock, forge <span class="o">(</span>see man<span class="o">)</span>
   -f           force operation <span class="o">(</span>i.e. even <span class="k">if</span> swap is active<span class="o">)</span>
   -g           use a GnuPG key to encrypt a tomb key
   -r           provide GnuPG recipients <span class="o">(</span>separated by comma<span class="o">)</span>
   -R           provide GnuPG hidden recipients <span class="o">(</span>separated by comma<span class="o">)</span>
   -h           print this <span class="nb">help</span>
   -v           print version, license and list of available ciphers
   -q           run quietly without printing informations
   -D           print debugging information at runtime
</code></pre></div><p>Now, let&rsquo;s think how to save our GPG keys.</p>
<p>The best way is to create two tombs, one for SUBKEYS <code>subkey.tomb</code>/<code>subkey.key</code> and the other one for MASTERKEY  <code>master.tomb</code>/<code>master.key</code>. Eventhoug, the USBKEY where will GPG keys be saved is gonna be LUKS encrypted (more on that later), still its good to have separation between SUBKEYS and MASTERKEY. As mentioned before, the masterkey is the one used only to issue subkeys, and this will potentially be living as long as you live (unless quantum qomputers break RSA, then we all are f**ked). So its important to have a separation. One good case that comes to mind is, when formatting main machine, we want again to setup/copy/work with subkeys, and if in those times there is a malware lurking in the machine it can compromise not only the subkeys, but masterkey too.</p>
<h2 id="forging-keys">FORGING KEYS</h2>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb forge master.key </div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Commanded to forge key master.key with cipher algorithm AES256
tomb <span class="o">[</span>W<span class="o">]</span> This operation takes time. Keep using this computer on other tasks.
tomb <span class="o">[</span>W<span class="o">]</span> Once <span class="k">done</span> you will be asked to choose a password <span class="k">for</span> your tomb.
tomb <span class="o">[</span>W<span class="o">]</span> To make it faster you can move the mouse around.
tomb <span class="o">[</span>W<span class="o">]</span> If you are on a server, you can use an Entropy Generation Daemon.
512+0 records in
512+0 records out
<span class="m">512</span> bytes copied, 0.00186594 s, <span class="m">274</span> kB/s
tomb <span class="o">(</span>*<span class="o">)</span> Choose the password of your key: master.key
tomb  .  <span class="o">(</span>You can also change it later using <span class="s1">&#39;tomb passwd&#39;</span>.<span class="o">)</span>
</code></pre></div><p>Then you get a prompt (keyring based on your OS/Distro) to give a passphrase to this key. Since the key itself is encrypted, and cant be opened without the pasphrase. After that you the password is created:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Key is valid.
tomb  .  Done forging master.key
tomb <span class="o">(</span>*<span class="o">)</span> Your key is ready:
-rw------- <span class="m">1</span> bruce bruce <span class="m">855</span> Jan <span class="m">10</span> 13:24 master.key
</code></pre></div><h2 id="dig-a-tomb">DIG A TOMB</h2>
<p>Now, after we have forged the keys, we ned to create the tombs:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb dig -s 100 master.tomb </div>
</div>

</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Commanded to dig tomb master.tomb
tomb <span class="o">(</span>*<span class="o">)</span> Creating a new tomb in master.tomb
tomb  .  Generating master.tomb of 100MiB
100+0 records in
100+0 records out
<span class="m">104857600</span> bytes <span class="o">(</span><span class="m">105</span> MB, <span class="m">100</span> MiB<span class="o">)</span> copied, 0.611086 s, <span class="m">172</span> MB/s

-rw------- <span class="m">1</span> bruce bruce 100M Jan <span class="m">10</span> 14:01 master.tomb
tomb <span class="o">(</span>*<span class="o">)</span> Done digging master
tomb  .  Your tomb is not yet ready, you need to forge a key and lock it.
tomb  .  tomb lock master.tomb -k master.key
</code></pre></div><h2 id="lock-the-tomb">LOCK THE TOMB</h2>
<p>And finally lets lock the tomb with the foged key:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb lock master.tomb -k master.key </div>
</div>

</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Commanded to lock tomb master.tomb
tomb  .  Checking <span class="k">if</span> the tomb is empty <span class="o">(</span>we never step on somebody <span class="k">else</span><span class="err">&#39;</span>s bones<span class="o">)</span>.
tomb  .  Fine, this tomb seems empty.
tomb  .  Key is valid.
tomb  .  Locking using cipher: aes-xts-plain64
tomb  .  A password is required to use key master.key
</code></pre></div><p>Now it will prompt the keyring for the keyphrase of the key:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Password OK.
tomb <span class="o">(</span>*<span class="o">)</span> Locking master.tomb with master.key
tomb  .  Formatting Luks mapped device.
tomb  .  Formatting your Tomb with Ext3/Ext4 filesystem.
tomb  .  Done locking master using Luks dm-crypt aes-xts-plain64
tomb <span class="o">(</span>*<span class="o">)</span> Your tomb is ready in master.tomb and secured with key master.key
</code></pre></div><h2 id="open-the-tomb">OPEN THE TOMB</h2>
<p>Now, to open a tomb:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb open master.tomb -k master.key </div>
</div>

</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Commanded to open tomb master.tomb
tomb  .  Valid tomb file found: master.tomb
tomb  .  Key is valid.
tomb  .  Mountpoint not specified, using default: /media/master
tomb <span class="o">(</span>*<span class="o">)</span> Opening master on /media/master
tomb  .  This tomb is a valid LUKS encrypted device.
tomb  .  Cipher is <span class="s2">&#34;aes&#34;</span> mode <span class="s2">&#34;xts-plain64&#34;</span> <span class="nb">hash</span> <span class="s2">&#34;sha512&#34;</span>
tomb  .  A password is required to use key master.key
</code></pre></div><p>Again, it will prompt the keyring for keyphrase to unlock the fogeed key:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Password OK.
tomb <span class="o">(</span>*<span class="o">)</span> Success unlocking tomb master
tomb  .  Checking filesystem via /dev/loop0
fsck from util-linux 2.34
master: clean, 11/25168 files, 8831/100352 blocks
tomb <span class="o">(</span>*<span class="o">)</span> Success opening master.tomb on /media/master
</code></pre></div><p>Now we have aa drive mouted on <code>/media/master/</code> where we can save secret key.</p>
<p>The exact same procedures are for subkeys too:</p>
<p>The same goes for <code>subkey.tomb</code>
first forge key:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb forge subkey.key </div>
</div>


then, create the tomb:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb dig -s 100 subkey.tomb </div>
</div>


then, lock the tomb with the key:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb lock subkey.tomb -k subkey.key </div>
</div>


then, opening the tomb:
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb open master.tomb -k master.key </div>
</div>


At the end we have another drive mouted on <code>/media/subkey/</code> where we can save subkeys key.</p>
<h2 id="slam-everything">SLAM EVERYTHING</h2>
<p>When finished, you could close each tomb with <code>tomb close {tombname}</code>, or you can all close at the same time, and kill all processes using it by issuing the command:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; tomb slam </div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb <span class="o">(</span>*<span class="o">)</span> Slamming tomb <span class="o">[</span>master<span class="o">]</span> mounted on /media/master
tomb  .  Closing tomb <span class="o">[</span>master<span class="o">]</span> mounted on /media/master
tomb <span class="o">(</span>*<span class="o">)</span> Tomb <span class="o">[</span>master<span class="o">]</span> closed: your bones will rest in peace.

tomb <span class="o">(</span>*<span class="o">)</span> Slamming tomb <span class="o">[</span>subkey<span class="o">]</span> mounted on /media/subkey
tomb  .  Closing tomb <span class="o">[</span>subkey<span class="o">]</span> mounted on /media/subkey
tomb <span class="o">(</span>*<span class="o">)</span> Tomb <span class="o">[</span>subkey<span class="o">]</span> closed: your bones will rest in peace.
</code></pre></div><h1 id="backing-up-keys">BACKING-UP KEYS</h1>
<p>Now that we have the tombs open, we can back up our GPG.</p>
<h2 id="pubickey-backup">PUBICKEY BACKUP</h2>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
gpg --armor --export bruce.wayne@waynecorp.com > $TEMP/public.asc
</div>
</div>


<h2 id="subkey-backup">SUBKEY BACKUP</h2>
<p>From last step, before we close/slam the tomb, we have mounted/opened the tomb on <code>/media/subkey</code>, and that&rsquo;s where we are going to back up the SUBKEYS:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
gpg --armor --export-secret-subkeys bruce.wayne@waynecorp.com > /media/subkey/subkeys.asc
</div>
</div>


<p>and then we close the tomb:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
tomb close subkey
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Closing tomb <span class="o">[</span>subkey<span class="o">]</span> mounted on /media/subkey
tomb <span class="o">(</span>*<span class="o">)</span> Tomb <span class="o">[</span>subkey<span class="o">]</span> closed: your bones will rest in peace.
</code></pre></div><h2 id="masterkey-backup">MASTERKEY BACKUP</h2>
<p>Since we didn&rsquo;t <code>tomb slam</code> to close all tombs, we only closed <code>subkey</code> tomb with close comand, so we have <code>master</code> tomb still open on <code>/media/subkey</code>, and that&rsquo;s where we are going to back up the MASTERKEY, and same time, we are going to back up there an INVOCATION CAETIFICATE, in case anytime the master is compromised we can use it, and procedures are the same like for <code>subkey</code>:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
gpg --armor --export-secret-subkeys bruce.wayne@waynecorp.com > /media/master/private.asc
</div>
</div>


<p>Now here, we dont close the tomb just yet, as we need to create an invocation certificate.</p>
<h2 id="invocation-certificate">INVOCATION CERTIFICATE</h2>
<p>To generate an revocation certificate, we use the command: (it will prompt for the GPG pasphrase)</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
gpg --armor --gen-revoke bruce.wayne@waynecorp.com > /media/master/revoke.cert
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sec  rsa4096/8E1C7857051C93A2 2020-01-10 Bruce Wayne <span class="o">(</span>JLA Launch Code PGP<span class="o">)</span> &lt;bruce.wayne@waynecorp.com&gt;
Create a revocation certificate <span class="k">for</span> this key? <span class="o">(</span>y/N<span class="o">)</span> y
--------------------------------
Please <span class="k">select</span> the reason <span class="k">for</span> the revocation:
  <span class="nv">0</span> <span class="o">=</span> No reason specified
  <span class="nv">1</span> <span class="o">=</span> Key has been compromised
  <span class="nv">2</span> <span class="o">=</span> Key is superseded
  <span class="nv">3</span> <span class="o">=</span> Key is no longer used
  <span class="nv">Q</span> <span class="o">=</span> Cancel
<span class="o">(</span>Probably you want to <span class="k">select</span> <span class="m">1</span> here<span class="o">)</span>
Your decision? 
--------------------------------
Enter an optional description<span class="p">;</span> end it with an empty line:
&gt; 
Reason <span class="k">for</span> revocation: Key has been compromised
<span class="o">(</span>No description given<span class="o">)</span>
--------------------------------
Is this okay? <span class="o">(</span>y/N<span class="o">)</span> y
Revocation certificate created.
</code></pre></div><p>and lastly we close the tomb:</p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
tomb close master
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tomb  .  Closing tomb <span class="o">[</span>master<span class="o">]</span> mounted on /run/media/bresilla/master
tomb <span class="o">(</span>*<span class="o">)</span> Tomb <span class="o">[</span>master<span class="o">]</span> closed: your bones will rest in peace.
</code></pre></div><h1 id="cryptoluks">CRYPTOLUKS</h1>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
lsblk
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                               
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         iso9660     2019-04-20-02-16-46-00                              
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo cryptsetup luksFormat /dev/sdb
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">WARNING: Device /dev/sdb already contains a <span class="s1">&#39;iso9660&#39;</span> superblock signature.
WARNING: Device /dev/sdb already contains a <span class="s1">&#39;dos&#39;</span> partition signature.
WARNING!
<span class="o">=</span><span class="o">=</span><span class="o">=</span><span class="o">=</span><span class="o">=</span><span class="o">=</span><span class="o">=</span><span class="o">=</span>
This will overwrite data on /dev/sdb irrevocably.
Are you sure? <span class="o">(</span>Type uppercase yes<span class="o">)</span>: YES
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">Enter passphrase <span class="k">for</span> /dev/sdb: 
Verify passphrase: 
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
lsblk
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262  
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo cryptsetup open /dev/sdb usb
</div>
</div>


<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">Enter passphrase <span class="k">for</span> /dev/sdb:
</code></pre></div><p>and <code>lsblk</code> gives:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262                
ââusb  
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo mkfs.btrfs -f /dev/mapper/usb
</div>
</div>


<p>after format, <code>lsblk</code> gives:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262                
ââusb       btrfs       d4d188b9-00ef-49db-aedd-a07fbd80f194 
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo mount /dev/mapper/usb /media/usb
</div>
</div>


<p>and after we have the drive mounted in <code>/media/usb/</code></p>
<div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo cp -acp $TEMP/{master.tomb, master.key, subkey.tomb, subkey.key, public.asc} /media/usb/
</div>
</div>


<p><code>lsblk</code> outputs:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262                
ââusb       btrfs       d4d188b9-00ef-49db-aedd-a07fbd80f194   15.3G     0% /media/usb
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo umount /media/usb
</div>
</div>


<p><code>lsblk</code> outputs:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262                
ââusb       btrfs       d4d188b9-00ef-49db-aedd-a07fbd80f194  
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
sudo cryptsetup close usb
</div>
</div>


<p><code>lsblk</code> outputs:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
sdb         crypto_LUKS ac9abe74-2769-4bb8-9805-5910ce7d3262                
</code></pre></div><div class="commandframeholder" >
    
    
    
    <div class="textframe" style="width: 100%; margin: 0 auto; padding: 1%; border-radius: 5px;
         background-color: var(--accent-color) ;
         color: var(--bg-color) ;
        " > &nbsp;&nbsp;$&nbsp;&nbsp; 
udisksctl power-off -b /dev/sdb
</div>
</div>


<p><code>lsblk</code> outputs:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">NAME        FSTYPE      UUID                                 FSAVAIL FSUSE% MOUNTPOINT
sda                                                                         
ââsda1      btrfs       944b1c42-56ea-43f1-9945-a40354dcd1be   50.8G    10% /
ââsda2      btrfs       d68c9b6c-1dee-4f53-b43f-b2a2dbb15472  103.5G    74% /opt
</code></pre></div>
        </span>
        
        <div style="padding-top:2%;" >
            <div style="width: 100vw; position: relative; left: calc(-50vw + 50%); height=100%;" >
                <div class="references" style="width: 50%; margin: 0 auto; padding: .4%; border-radius: 5px; border: 2px dashed var(--accent-color); color: var(--accent-color);" >
                <details class="references" style="padding-left:2%;" >
                    <summary style="font-size:1.5em;" > References</summary>
                    <div style="padding:1%;" >
                        
                        <div style="padding:.2%; padding-left:2%;" >
                            - <a href="https://www.dyne.org/software/tomb/" > https://www.dyne.org/software/tomb/ </a>
                        </div>
                        
                        <div style="padding:.2%; padding-left:2%;" >
                            - <a href="https://github.com/drduh/YubiKey-Guide" > https://github.com/drduh/YubiKey-Guide </a>
                        </div>
                        
                        <div style="padding:.2%; padding-left:2%;" >
                            - <a href="https://spin.atomicobject.com/2013/11/24/secure-gpg-keys-guide/" > https://spin.atomicobject.com/2013/11/24/secure-gpg-keys-guide/ </a>
                        </div>
                        
                    </div>
                </details>
                </div>
                    <style> @media only screen and (max-width : 768px) { .references { width: 90% !important; } } </style>
            </div>
        </div>
        
    </article>
</section>

    

            </div>
            <footer class="footer">
  <section class="container">
        <a href="https://www.unibo.it/en"><p>ALMA MATER STUDIORUM UNIVERSITA DI BOLOGNA</p></a>
  </section>
</footer>

        </main>
        

        
        
        <script type="text/javascript" src="/jquery/jquery-1.11.3.min.js"></script>
        <script type="text/javascript" src="/jquery/jquery.typedjs-2.0.11.min.js"></script>
        
        <script type="text/javascript" src="/scripts/coder.js"></script>

    </body>
</html>
